<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>UDE examples · UniversalDiffEq.jl</title><meta name="title" content="UDE examples · UniversalDiffEq.jl"/><meta property="og:title" content="UDE examples · UniversalDiffEq.jl"/><meta property="twitter:title" content="UDE examples · UniversalDiffEq.jl"/><meta name="description" content="Documentation for UniversalDiffEq.jl."/><meta property="og:description" content="Documentation for UniversalDiffEq.jl."/><meta property="twitter:description" content="Documentation for UniversalDiffEq.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">UniversalDiffEq.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">UniversalDiffEq.jl</a></li><li><a class="tocitem" href="../Models/">Model Constructors</a></li><li><a class="tocitem" href="../ModelTesting/">Test models</a></li><li><a class="tocitem" href="../NutsAndBolts/">UDE model construction</a></li><li><a class="tocitem" href="../MultipleTimeSeries/">Fitting a model to multiple time series</a></li><li><a class="tocitem" href="../modelanalysis/">Model analysis</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>UDE examples</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>UDE examples</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Jack-H-Buckner/UniversalDiffEq.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Jack-H-Buckner/UniversalDiffEq.jl/blob/main/docs/src/examples.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="UDE-examples"><a class="docs-heading-anchor" href="#UDE-examples">UDE examples</a><a id="UDE-examples-1"></a><a class="docs-heading-anchor-permalink" href="#UDE-examples" title="Permalink"></a></h1><h2 id="Using-time-dependent-NODEs-to-predict-regiem-changes"><a class="docs-heading-anchor" href="#Using-time-dependent-NODEs-to-predict-regiem-changes">Using time dependent NODEs to predict regiem changes</a><a id="Using-time-dependent-NODEs-to-predict-regiem-changes-1"></a><a class="docs-heading-anchor-permalink" href="#Using-time-dependent-NODEs-to-predict-regiem-changes" title="Permalink"></a></h2><p>One intersting use of NODE and UDE models in ecology is detecting and predicting regiem changes, sudden shifts in the strucutre and function of an ecosystem cause by a small change in conditions. Regiem chagnes are caused by the interaction of non-linear feedback mechiamsms, environmental variability and long term environemtnal change. NODE an UDE model built with UniversalDiffEq can capture all three of these proceses opeining upt he possibiltiy of detecting and predicting regiem chagnes from data. </p><p>In the followng example we build a NODE model for a two species system that under goes a regiem change. The data are simulated from the Mumby-hastings model of coral-algae competition with an added term for stochastic coral mortaltiy events and a long term increase in the coral mortaltiy rate from increasing temperature. The increasing temperature eventually causes the system to shift from a coral to and algae dominated state (figure 1). The data up to the time of the regime chagne are used to fit the model.</p><p><img src="../figures/regiem_changes_state_estiamtes.png" alt="figure 1: simulated regime chagne data "/></p><p>The model is a function of the area covered by coral <span>$p_C$</span> and algae <span>$p_A$</span> an environemtnal covariate <span>$X$</span> that is related to coral mortality and time <span>$t$</span> to capture the effect of the slowling increasing coral mortaltiy rate. The coral and macro algae abundances are transformed to <span>$x_i = softmax^{-1}(p_i)$</span> using the inverse soft_max transformation  before fitting the model </p><p class="math-container">\[    \frac{dx_C}{dt} = NN_1(x_C,x_A,X,t) \\ 
    \frac{dx_A}{dt} = NN_2(x_C,x_A,X,t) \\ \]</p><p>UniversalDiffEq does not have built in methods to constructing time dependent NODES but they can be build easily enough using the CustomDerivatives function. In this case, we initialize a neural network that take four inputs (one for each species, the environemtnal covariate and time) and two outputs using Lux.jl. The deriviatives function <code>derivs!</code> divides time by 50 to match the sale of the other inputs, concatanates the abundnaces of eahc species, the covariate <span>$X$</span> and time into a vector and evaluates the neural network. The UDE model is constructed using the CustomDerivatives function passing both the species data in a data framed called <code>data</code> and the covairate in a dataframe labeld <code>X</code>.</p><pre><code class="language-julia hljs">using Lux, UniversalDiffEq
# set neural network dimensions
dims_in = 4 
dims_out = 2
hidden = 10


# Define neurla network with Lux.jl
NN = Lux.Chain(Lux.Dense(dims_in, hidden, tanh), Lux.Dense(hidden,dims_out))
rng = Random.default_rng() 
NNparameters, NNstates = Lux.setup(rng,NN) 
parameters = (NN = NNparameters,)


# Define derivatives (time dependent NODE)
function derivs!(du,u,X,p,t)
    inputs = [u[1],u[2],X[1],t/50-1.0]
    vals = NN(inputs,p.NN,NNstates)[1]
    du[1] = vals[1]
    du[2] = vals[2]
    return du 
end 

model = UniversalDiffEq.CustomDerivatives(data[1:80,:],X,derivs!,parameters;proc_weight=2.5,obs_weight=10.0,reg_weight=10^-3.5)

gradient_decent!(model, verbos = true, maxiter = 250)
BFGS!(model, verbos = true )</code></pre><p>To verify the model fit  <img src="../figures/regiem_changes_state_estiamtes.png" alt/></p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Friday 22 March 2024 04:32">Friday 22 March 2024</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Model Constructors · UniversalDiffEq.jl</title><meta name="title" content="Model Constructors · UniversalDiffEq.jl"/><meta property="og:title" content="Model Constructors · UniversalDiffEq.jl"/><meta property="twitter:title" content="Model Constructors · UniversalDiffEq.jl"/><meta name="description" content="Documentation for UniversalDiffEq.jl."/><meta property="og:description" content="Documentation for UniversalDiffEq.jl."/><meta property="twitter:description" content="Documentation for UniversalDiffEq.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">UniversalDiffEq.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">UniversalDiffEq.jl</a></li><li class="is-active"><a class="tocitem" href>Model Constructors</a><ul class="internal"><li><a class="tocitem" href="#NODEs-(i.e.,-nonparametric-universal-dynamic-equations)"><span>NODEs (i.e., nonparametric universal dynamic equations)</span></a></li><li><a class="tocitem" href="#Customizing-universal-dynamic-equations"><span>Customizing universal dynamic equations</span></a></li><li><a class="tocitem" href="#Adding-covariates"><span>Adding covariates</span></a></li><li><a class="tocitem" href="#Adding-prior-information"><span>Adding prior information</span></a></li></ul></li><li><a class="tocitem" href="../EasyModels/">Easy NODE and UDE</a></li><li><a class="tocitem" href="../ModelTesting/">Model performance</a></li><li><a class="tocitem" href="../NutsAndBolts/">UDE model construction</a></li><li><a class="tocitem" href="../MultipleTimeSeries/">Fitting a model to multiple time series</a></li><li><a class="tocitem" href="../modelanalysis/">Model analysis</a></li><li><a class="tocitem" href="../BayesianModels/">Bayesian Models</a></li><li><a class="tocitem" href="../examples/">Examples</a></li><li><a class="tocitem" href="../API/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Model Constructors</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Model Constructors</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Jack-H-Buckner/UniversalDiffEq.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Jack-H-Buckner/UniversalDiffEq.jl/blob/main/docs/src/Models.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Model-Constructors"><a class="docs-heading-anchor" href="#Model-Constructors">Model Constructors</a><a id="Model-Constructors-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Constructors" title="Permalink"></a></h1><p>UniversalDiffEq.jl provides a set of functions to construct universal differential equations (UDEs) and neural ordinary differential equations (NODEs) with varying levels of customization. The model constructors all require the data to be passed using a DataFrame object from the DataFrames.jl library. The data frame should be organized with one column for time and one column for each dimension of the observations. The name of the column for time is passed using a keyword argument <code>time_column_name</code> that has a default value &quot;<code>time</code>&quot;.</p><p><strong>Table</strong>: Example dataset with two state variables</p><table><tr><th style="text-align: right"><code>time</code></th><th style="text-align: right"><span>$y_1$</span></th><th style="text-align: right"><span>$y_2$</span></th></tr><tr><td style="text-align: right">0.1</td><td style="text-align: right">0.0</td><td style="text-align: right">-1.1</td></tr><tr><td style="text-align: right">0.2</td><td style="text-align: right">0.01</td><td style="text-align: right">-0.9</td></tr><tr><td style="text-align: right">0.5</td><td style="text-align: right">0.51</td><td style="text-align: right">-1.05</td></tr></table><p>Currently, missing data are not directly supported, but irregular intervals between time points are allowed.</p><p>Each constructor function requires additional inputs to specify the model structure. For example, the <code>CustomDerivatives</code> function requires the user to supply the known functional forms through the <code>derivs!</code> argument. The subsection for each model type describes these arguments in detail.</p><p>Finally, the constructor functions share a set of keyword arguments (<code>kwargs</code>) used to tune the model fitting procedure. These control the weights given to the process model, observation model, and regularization in the loss function. Larger values of the regularization weight limit the complexity of the relationships learned by the neural network to reduce the likelihood of overfitting. The observation weight controls how closely the estimated states <span>$u_t$</span> match the observations <span>$y_t$</span>; smaller values of the observation weight correspond to datasets with larger amounts of observation error and vice versa.</p><ul><li><code>proc_weight=1.0</code> : The weight given to the model predictions in the loss function</li><li><code>obs_weight=1.0</code> : The weight given to the state estimates in the loss function</li><li><code>reg_weight=0.0</code> : The weight given to regularization in the loss function</li></ul><p>In addition to these weighting parameters, the keyword argument <code>l</code> controls how far the model will extrapolate beyond the observed data before reverting to a default value <code>extrap_rho</code> when forecasting.</p><h2 id="NODEs-(i.e.,-nonparametric-universal-dynamic-equations)"><a class="docs-heading-anchor" href="#NODEs-(i.e.,-nonparametric-universal-dynamic-equations)">NODEs (i.e., nonparametric universal dynamic equations)</a><a id="NODEs-(i.e.,-nonparametric-universal-dynamic-equations)-1"></a><a class="docs-heading-anchor-permalink" href="#NODEs-(i.e.,-nonparametric-universal-dynamic-equations)" title="Permalink"></a></h2><p>UniversalDiffEq.jl has two functions to build time series models that use a neural network to learn the dynamics of a time series. The function <code>NODE</code> builds a continuous-time UDE with a neural network representing the right-hand side of the differential equation</p><p class="math-container">\[   \frac{du}{dt} = NN(u;w,b),\]</p><p>The function <code>NNDE</code> (neural network difference equation) constructs a discrete-time model with a neural network on the right-hand side</p><p class="math-container">\[   x_{t+1} = x_t + NN(x_t).\]</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="UniversalDiffEq.NODE-Tuple{Any}-Models" href="#UniversalDiffEq.NODE-Tuple{Any}-Models"><code>UniversalDiffEq.NODE</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">NODE(data;kwargs ... )</code></pre><p>Constructs a nonparametric continuous time model for the data set <code>data</code> using a single layer neural network to represent the systems dynamics.</p><pre><code class="nohighlight hljs"># kwargs</code></pre><ul><li><code>time_column_name</code>: Name of column in <code>data</code> that corresponds to time. Default is <code>&quot;time&quot;</code>.</li><li><code>hidden_units</code>: Number of neurons in hidden layer. Default is <code>10</code>.</li><li><code>seed</code>: Fixed random seed for repeatable results. Default is <code>1</code>.</li><li><code>proc_weight</code>: Weight of process error <code>omega_{proc}</code>. Default is <code>1.0</code>.</li><li><code>obs_weight</code>: Weight of observation error <code>omega_{obs}</code>. Default is <code>1.0</code>.</li><li><code>reg_weight</code>: Weight of regularization error <code>omega_{reg}</code>. Default is <code>10^-6</code>.</li><li><code>reg_type</code>: Type of regularization, whether <code>&quot;L1&quot;</code> or <code>&quot;L2&quot;</code> regularization. Default is <code>&quot;L2&quot;</code>.</li><li><code>l</code>: Extrapolation parameter for forecasting. Default is <code>0.25</code>.</li><li><code>extrap_rho</code>: Extrapolation parameter for forecasting. Default is <code>0.0</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Jack-H-Buckner/UniversalDiffEq.jl/blob/12be76d7cb0507547e9d2a5eac4e2dafeefab18d/src/Models.jl#L606-L623">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="UniversalDiffEq.NNDE-Tuple{Any}-Models" href="#UniversalDiffEq.NNDE-Tuple{Any}-Models"><code>UniversalDiffEq.NNDE</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">NNDE(data;kwargs ...)</code></pre><p>Constructs a nonparametric discrete time model for the data set <code>data</code> using a single layer neural network to represent the systems dynamics.</p><pre><code class="nohighlight hljs"># kwargs</code></pre><ul><li><code>time_column_name</code>: Name of column in <code>data</code> that corresponds to time. Default is <code>&quot;time&quot;</code>.</li><li><code>hidden_units</code>: Number of neurons in hidden layer. Default is <code>10</code>.</li><li><code>seed</code>: Fixed random seed for repeatable results. Default is <code>1</code>.</li><li><code>proc_weight</code>: Weight of process error <code>omega_{proc}</code>. Default is <code>1.0</code>.</li><li><code>obs_weight</code>: Weight of observation error <code>omega_{obs}</code>. Default is <code>1.0</code>.</li><li><code>reg_weight</code>: Weight of regularization error <code>omega_{reg}</code>. Default is <code>10^-6</code>.</li><li><code>reg_type</code>: Type of regularization, whether <code>&quot;L1&quot;</code> or <code>&quot;L2&quot;</code> regularization. Default is <code>&quot;L2&quot;</code>.</li><li><code>l</code>: Extrapolation parameter for forecasting. Default is <code>0.25</code>.</li><li><code>extrap_rho</code>: Extrapolation parameter for forecasting. Default is <code>0.0</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Jack-H-Buckner/UniversalDiffEq.jl/blob/12be76d7cb0507547e9d2a5eac4e2dafeefab18d/src/Models.jl#L527-L543">source</a></section></article><p>Covariates can be included in the model by supplying a second data frame, <code>X.</code> This data frame must have the same column name for time as the primary dataset, but the time points do not need to match because the values of the covariates between time points included in the data frame <code>X</code> are interpolated using a linear spline.  The <code>NODE</code> and <code>NNDE</code> functions will append the value of the covariates at each point in time to the neural network inputs</p><p class="math-container">\[   \frac{dx}{dt} = NN(x,X(t);w,b) \\
   x_{t+1} = x_t + NN(x_t, X(t)).\]</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="UniversalDiffEq.NODE-Tuple{Any, Any}-Models" href="#UniversalDiffEq.NODE-Tuple{Any, Any}-Models"><code>UniversalDiffEq.NODE</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">NODE(data,X;kwargs ... )</code></pre><p>When a dataframe <code>X</code> is supplied the model will run with covariates. the argument <code>X</code> should have a column for time <code>t</code> with the value for time in the remaining columns. The values in <code>X</code> will be interpolated with a linear spline for values of time not included in the data frame.</p><ul><li><code>time_column_name</code>: Name of column in <code>data</code> and <code>X</code> that corresponds to time. Default is <code>&quot;time&quot;</code>.</li><li><code>variable_column_name</code>: Name of column in <code>X</code> that corresponds to the variables. Default is <code>nothing</code>.</li><li><code>value_column_name</code>: Name of column in <code>X</code> that corresponds to the covariates. Default is <code>nothing</code>.</li><li><code>hidden_units</code>: Number of neurons in hidden layer. Default is <code>10</code>.</li><li><code>seed</code>: Fixed random seed for repeatable results. Default is <code>1</code>.</li><li><code>proc_weight</code>: Weight of process error <code>omega_{proc}</code>. Default is <code>1.0</code>.</li><li><code>obs_weight</code>: Weight of observation error <code>omega_{obs}</code>. Default is <code>1.0</code>.</li><li><code>reg_weight</code>: Weight of regularization error <code>omega_{reg}</code>. Default is <code>10^-6</code>.</li><li><code>reg_type</code>: Type of regularization, whether <code>&quot;L1&quot;</code> or <code>&quot;L2&quot;</code> regularization. Default is <code>&quot;L2&quot;</code>.</li><li><code>l</code>: Extrapolation parameter for forecasting. Default is <code>0.25</code>.</li><li><code>extrap_rho</code>: Extrapolation parameter for forecasting. Default is <code>0.0</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Jack-H-Buckner/UniversalDiffEq.jl/blob/12be76d7cb0507547e9d2a5eac4e2dafeefab18d/src/Models.jl#L660-L676">source</a></section></article><p>Long-format datasets can be used to define models with multiple covariates that have different sampling frequencies. If a long-format dataset is provided, the user must specify which column contains the variable names and which column contains the values of the variables using the <code>variable_column_name</code> and <code>value_column_name</code> keywords. In the example below, the variable column name is &quot;<code>variable</code>&quot;, and the value column name is &quot;<code>value</code>&quot;.</p><p><strong>Table</strong>: Example covariate data in long format</p><table><tr><th style="text-align: right"><code>time</code></th><th style="text-align: right"><code>variable</code></th><th style="text-align: right"><code>value</code></th></tr><tr><td style="text-align: right">1.0</td><td style="text-align: right">X_1</td><td style="text-align: right">-1.1</td></tr><tr><td style="text-align: right">2.0</td><td style="text-align: right">X_1</td><td style="text-align: right">-0.9</td></tr><tr><td style="text-align: right">3.0</td><td style="text-align: right">X_1</td><td style="text-align: right">-1.05</td></tr><tr><td style="text-align: right">...</td><td style="text-align: right">...</td><td style="text-align: right">...</td></tr><tr><td style="text-align: right">1.0</td><td style="text-align: right">X_2</td><td style="text-align: right">3.0</td></tr><tr><td style="text-align: right">2.0</td><td style="text-align: right">X_2</td><td style="text-align: right">0.95</td></tr><tr><td style="text-align: right">4.0</td><td style="text-align: right">X_2</td><td style="text-align: right">-1.25</td></tr></table><h2 id="Customizing-universal-dynamic-equations"><a class="docs-heading-anchor" href="#Customizing-universal-dynamic-equations">Customizing universal dynamic equations</a><a id="Customizing-universal-dynamic-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Customizing-universal-dynamic-equations" title="Permalink"></a></h2><p>The <code>CustomDerivatives</code> and <code>CustomDifference</code> functions can be used to build models that combine neural networks and known functional forms. These functions take user-defined models, construct a loss function, and access the model fitting and testing functions provided by UniversalDiffEq.jl.</p><h3 id="Continuous-time-models"><a class="docs-heading-anchor" href="#Continuous-time-models">Continuous-time models</a><a id="Continuous-time-models-1"></a><a class="docs-heading-anchor-permalink" href="#Continuous-time-models" title="Permalink"></a></h3><p>The <code>CustomDerivatives</code> function builds SS-UDE models based on a user-defined function <code>derivs!(du,u,p,t)</code>, which updates the vector <code>du</code> with the right-hand side of a differential equation evaluated at time <code>t</code> in state <code>u</code> given parameters <code>p</code>. The function also needs an initial guess at the model parameters, specified by a NamedTuple <code>initial_parameters</code></p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="UniversalDiffEq.CustomDerivatives-Tuple{Any, Any, Any}-Models" href="#UniversalDiffEq.CustomDerivatives-Tuple{Any, Any, Any}-Models"><code>UniversalDiffEq.CustomDerivatives</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">CustomDerivatives(data,derivs!,initial_parameters;kwargs ... )</code></pre><p>Constructs a UDE model for the data set <code>data</code>  based on user defined derivatives <code>derivs</code>. An initial guess of model parameters are supplied with the <code>initial_parameters</code> argument.</p><p>...</p><p><strong>Arguments</strong></p><ul><li>data: a DataFrame object with the time of observations in a column labeled <code>t</code> and the remaining columns the value of the state variables at each time point.</li><li>derivs: a Function of the form <code>derivs!(du,u,p,t)</code> where <code>u</code> is the value of the state variables, <code>p</code> are the model parameters, <code>t</code> is time, and du is updated with the value of the derivatives</li><li>init_parameters: A <code>NamedTuple</code> with the model parameters. Neural network parameters must be listed under the key <code>NN</code>.</li></ul><p><strong>kwargs</strong></p><ul><li><code>time_column_name</code>: Name of column in <code>data</code> that corresponds to time. Default is <code>&quot;time&quot;</code>.</li><li><code>proc_weight</code>: Weight of process error <code>omega_{proc}</code>. Default is <code>1.0</code>.</li><li><code>obs_weight</code>: Weight of observation error <code>omega_{obs}</code>. Default is <code>1.0</code>.</li><li><code>reg_weight</code>: Weight of regularization error <code>omega_{reg}</code>. Default is <code>10^-6</code>.</li><li><code>reg_type</code>: Type of regularization, whether <code>&quot;L1&quot;</code> or <code>&quot;L2&quot;</code> regularization. Default is <code>&quot;L2&quot;</code>.</li><li><code>l</code>: Extrapolation parameter for forecasting. Default is <code>0.25</code>.</li><li><code>extrap_rho</code>: Extrapolation parameter for forecasting. Default is <code>0.0</code>.</li></ul><p>...</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Jack-H-Buckner/UniversalDiffEq.jl/blob/12be76d7cb0507547e9d2a5eac4e2dafeefab18d/src/Models.jl#L89-L111">source</a></section></article><h3 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h3><p>The following block of code shows how to build a UDE model based on the Lotka-Volterra predator-prey model where the growth rate of the prey <span>$r$</span>, mortality rate of the predator <span>$m$</span>, and conversion efficiency <span>$\theta$</span> are estimated, and the predation rate is described by a neural network <span>$NN$</span></p><p class="math-container">\[\frac{dN}{dt} = rN - NN(N,P)

\\

\frac{dP}{dt} = \theta NN(N,P) - mP.\]</p><p>To implement the model, we define the neural network and initialize its parameters using the <code>Lux.Chain</code> and  <code>Lux.setup</code> functions.</p><pre><code class="language-julia hljs">using Lux
# Build the neural network with Lux.Chain
dims_in = 2
hidden_units = 10
nonlinearity = tanh
dims_out = 1
NN = Lux.Chain(Lux.Dense(dims_in,hidden_units,nonlinearity),Lux.Dense(hidden_units,dims_out))

# initialize the neural network states and parameters
using Random
rng = Random.default_rng()
NNparameters, states = Lux.setup(rng,NN)</code></pre><p>With the neural network in hand, we define the derivatives of the differential equations model using standard Julia syntax. The <code>derivs</code> function first evaluates the neural network given the abundances of the predators and prey <code>u</code>. The neural network function <code>NN</code> requires three arguments: the state variables <code>u</code>, the network parameters, and the network states. In this example, we store the model parameters in a named tuple <code>p</code>, and we access the neural network parameters with the <code>NN</code>. We access the other model parameters using keys corresponding to their respective names.</p><pre><code class="language-julia hljs">function lotka_volterra_derivs!(du,u,p,t)
    C, states = NN(u,p.NN,states)
    du[1] = p.r*u[1] - C[1]
    du[2] = p.theta*C[1] -p.m*u[2]
end</code></pre><p>Finally, we can define the initial parameters as a NamedTuple and build the model using the <code>CustomDerivatives</code> function.</p><pre><code class="language-julia hljs">using UniversalDiffEq
initial_parameters = (NN = NNparameters, r = 1.0, m = 0.5, theta = 0.5)
model = CustomDerivatives(data,lotka_volterra_derivs!,initial_parameters)</code></pre><h3 id="Discrete-time-models"><a class="docs-heading-anchor" href="#Discrete-time-models">Discrete-time models</a><a id="Discrete-time-models-1"></a><a class="docs-heading-anchor-permalink" href="#Discrete-time-models" title="Permalink"></a></h3><p>Discrete-time models are constructed similarly to continuous-time models. The user provides a dataset, initial parameter values, and the right-hand side of a discrete-time equation with the function <code>step</code></p><p class="math-container">\[U_{t+1} = \text{step}(u_t,t,p).\]</p><p>The function <code>step(u,t,p)</code> takes three arguments: the value of the state variables <code>u</code>, time <code>t</code>, and model parameters <code>p</code>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="UniversalDiffEq.CustomDifference-Tuple{Any, Any, Any}-Models" href="#UniversalDiffEq.CustomDifference-Tuple{Any, Any, Any}-Models"><code>UniversalDiffEq.CustomDifference</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">CustomDifference(data,step,initial_parameters;kwrags...)</code></pre><p>Constructs a UDE model for the data set <code>data</code> based on user defined difference equation <code>step</code>. An initial guess of model parameters are supplied with the initial_parameters argument. ...</p><p><strong>Arguments</strong></p><ul><li>data: a DataFrame object with the time of observations in a column labeled <code>t</code> and the remaining columns the value of the state variables at each time point.</li><li>step: a Function of the form <code>step(u,t,p)</code> where <code>u</code> is the value of the state variables, <code>p</code> are the model parameters.</li><li>init_parameters: A <code>NamedTuple</code> with the model parameters. Neural network parameters must be listed under the key <code>NN</code>.</li></ul><p><strong>kwargs</strong></p><ul><li><code>time_column_name</code>: Name of column in <code>data</code> that corresponds to time. Default is <code>&quot;time&quot;</code>.</li><li><code>proc_weight</code>: Weight of process error <code>omega_{proc}</code>. Default is <code>1.0</code>.</li><li><code>obs_weight</code>: Weight of observation error <code>omega_{obs}</code>. Default is <code>1.0</code>.</li><li><code>reg_weight</code>: Weight of regularization error <code>omega_{reg}</code>. Default is <code>10^-6</code>.</li><li><code>reg_type</code>: Type of regularization, whether <code>&quot;L1&quot;</code> or <code>&quot;L2&quot;</code> regularization. Default is <code>&quot;L2&quot;</code>.</li><li><code>l</code>: Extrapolation parameter for forecasting. Default is <code>0.25</code>.</li><li><code>extrap_rho</code>: Extrapolation parameter for forecasting. Default is <code>0.0</code>.</li></ul><p>...</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Jack-H-Buckner/UniversalDiffEq.jl/blob/12be76d7cb0507547e9d2a5eac4e2dafeefab18d/src/Models.jl#L317-L337">source</a></section></article><h2 id="Adding-covariates"><a class="docs-heading-anchor" href="#Adding-covariates">Adding covariates</a><a id="Adding-covariates-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-covariates" title="Permalink"></a></h2><p>Covariates are added to UDE models by passing a data frame <code>X</code> to the constructor function. The covariates must also be added as an argument to the <code>derivs!</code> function, which has the new form <code>derivs!(du,u,X,p,t)</code>, where the third argument <code>X</code> is a vector with the value of each covariate at time <code>t</code>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="UniversalDiffEq.CustomDerivatives-Tuple{DataFrame, DataFrame, Function, Any}-Models" href="#UniversalDiffEq.CustomDerivatives-Tuple{DataFrame, DataFrame, Function, Any}-Models"><code>UniversalDiffEq.CustomDerivatives</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">CustomDerivatives(data::DataFrame,X::DataFrame,derivs!::Function,initial_parameters;kwargs ... )</code></pre><p>When a dataframe <code>X</code> is supplied the model will run with covariates. the argument <code>X</code> should have a column for time <code>t</code> with the value for time in the remaining columns. The values in <code>X</code> will be interpolated with a linear spline for values of time not included in the data frame.</p><p>When <code>X</code> is provided the derivs function must have the form <code>derivs!(du,u,x,p,t)</code> where <code>x</code> is a vector with the value of the covariates at time <code>t</code>.</p><p><strong>kwargs</strong></p><ul><li><code>time_column_name</code>: Name of column in <code>data</code> and <code>X</code> that corresponds to time. Default is <code>&quot;time&quot;</code>.</li><li><code>variable_column_name</code>: Name of column in <code>X</code> that corresponds to the variables. Default is <code>nothing</code>.</li><li><code>value_column_name</code>: Name of column in <code>X</code> that corresponds to the covariates. Default is <code>nothing</code>.</li><li><code>proc_weight</code>: Weight of process error <code>omega_{proc}</code>. Default is <code>1.0</code>.</li><li><code>obs_weight</code>: Weight of observation error <code>omega_{obs}</code>. Default is <code>1.0</code>.</li><li><code>reg_weight</code>: Weight of regularization error <code>omega_{reg}</code>. Default is <code>10^-6</code>.</li><li><code>reg_type</code>: Type of regularization, whether <code>&quot;L1&quot;</code> or <code>&quot;L2&quot;</code> regularization. Default is <code>&quot;L2&quot;</code>.</li><li><code>l</code>: Extrapolation parameter for forecasting. Default is <code>0.25</code>.</li><li><code>extrap_rho</code>: Extrapolation parameter for forecasting. Default is <code>0.0</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Jack-H-Buckner/UniversalDiffEq.jl/blob/12be76d7cb0507547e9d2a5eac4e2dafeefab18d/src/Models.jl#L216-L234">source</a></section></article><p>Covariates can  be added to discrete-time models in the same way. In this case the <code>step</code> function should have four arguments <code>step(u,X,t,p)</code>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="UniversalDiffEq.CustomDifference-Tuple{DataFrame, Any, Any, Any}-Models" href="#UniversalDiffEq.CustomDifference-Tuple{DataFrame, Any, Any, Any}-Models"><code>UniversalDiffEq.CustomDifference</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">CustomDifference(data::DataFrame,X,step,initial_parameters;kwargs ... )</code></pre><p>When a dataframe <code>X</code> is supplied the model will run with covariates. the argument <code>X</code> should have a column for time <code>t</code> with the value for time in the remaining columns. The values in <code>X</code> will be interpolated with a linear spline for value of time not included in the data frame.</p><p>When <code>X</code> is provided the step function must have the form <code>step(u,x,t,p)</code> where <code>x</code> is a vector with the value of the covariates at time <code>t</code>.</p><pre><code class="nohighlight hljs"># kwargs</code></pre><ul><li><code>time_column_name</code>: Name of column in <code>data</code> and <code>X</code> that corresponds to time. Default is <code>&quot;time&quot;</code>.</li><li><code>variable_column_name</code>: Name of column in <code>X</code> that corresponds to the variables. Default is <code>nothing</code>.</li><li><code>value_column_name</code>: Name of column in <code>X</code> that corresponds to the covariates. Default is <code>nothing</code>.</li><li><code>proc_weight</code>: Weight of process error <code>omega_{proc}</code>. Default is <code>1.0</code>.</li><li><code>obs_weight</code>: Weight of observation error <code>omega_{obs}</code>. Default is <code>1.0</code>.</li><li><code>reg_weight</code>: Weight of regularization error <code>omega_{reg}</code>. Default is <code>10^-6</code>.</li><li><code>reg_type</code>: Type of regularization, whether <code>&quot;L1&quot;</code> or <code>&quot;L2&quot;</code> regularization. Default is <code>&quot;L2&quot;</code>.</li><li><code>l</code>: Extrapolation parameter for forecasting. Default is <code>0.25</code>.</li><li><code>extrap_rho</code>: Extrapolation parameter for forecasting. Default is <code>0.0</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Jack-H-Buckner/UniversalDiffEq.jl/blob/12be76d7cb0507547e9d2a5eac4e2dafeefab18d/src/Models.jl#L431-L449">source</a></section></article><h3 id="Example-2"><a class="docs-heading-anchor" href="#Example-2">Example</a><a class="docs-heading-anchor-permalink" href="#Example-2" title="Permalink"></a></h3><p>We extend the Lotka-Volterra equations defined in the prior example to  incorporate a covariate <code>X</code> that influences the abundance of predators and prey. We model this effect with linear coefficients <span>$\beta_N$</span> and <span>$\beta_P$</span></p><p class="math-container">\[\frac{dN}{dt} = rN - NN(N,P) + \beta_N N

\\

\frac{dP}{dt} = \theta NN(N,P) - mP + \beta_P P.\]</p><pre><code class="language-julia hljs"># set up neural network
using Lux
dims_in = 2
hidden_units = 10
nonlinearity = tanh
dims_out = 1
NN = Lux.Chain(Lux.Dense(dims_in,hidden_units,nonlinearity),Lux.Dense(hidden_units,dims_out))

# initialize parameters
using Random
rng = Random.default_rng()
NNparameters, NNstates = Lux.setup(rng,NN)

function derivs!(du,u,X,p,t)
    C, states = NN(u,p.NN, NNstates)
    du[1] = p.r*u[1] - C[1] + p.beta[1] * X[1]
    du[2] = p.theta*C[1] -p.m*u[2] + p.beta[2] * X[1]
end

init_parameters = (NN = NNparameters, r = 1.0, m = 0.5, theta = 0.5, beta = [0,0])


model = CustomDerivatives(training_data,X,derivs!;init_parameters;proc_weight=2.0,obs_weight=0.5,reg_weight=10^-4)
nothing</code></pre><h2 id="Adding-prior-information"><a class="docs-heading-anchor" href="#Adding-prior-information">Adding prior information</a><a id="Adding-prior-information-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-prior-information" title="Permalink"></a></h2><p>Users can add priors and custom neural network regularization functions by passing a function to the model constructor that takes the parameters as an argument and returns the loss associated with those parameter values. Please note that the loss functions defined by UniversalDiffEq.jl use the mean squared errors of the model rather than a likelihood function, so priors over the model parameters will not have the usual Bayesian interpretation.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="UniversalDiffEq.CustomDerivatives-Tuple{DataFrame, Function, Any, Function}-Models" href="#UniversalDiffEq.CustomDerivatives-Tuple{DataFrame, Function, Any, Function}-Models"><code>UniversalDiffEq.CustomDerivatives</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">CustomDerivatives(data::DataFrame,derivs!::Function,initial_parameters,priors::Function;kwargs ... )</code></pre><p>When a function&#39;s priors is supplied its value will be added to the loss function as a penalty term for user specified parameters. It should take the a single NamedTuple <code>p</code> as an argument penalties for each paramter should be calculated by accessing <code>p</code> with the period operator.</p><p>The prior function can be used to nudge the fitted model toward prior expectations for a parameter value. For example, the following function increases the loss when a parameter <code>p.r</code> has a value other than 1.5, nad a second parameter <code>p.beta</code> is greater than zeros.</p><pre><code class="language-julia hljs">function priors(p)
    l = 0.01*(p.r - 1.5)^2
    l += 0.01*(p.beta)^2
    return l
end</code></pre><p><strong>kwargs</strong></p><ul><li><code>time_column_name</code>: Name of column in <code>data</code> that corresponds to time. Default is <code>&quot;time&quot;</code>.</li><li><code>proc_weight</code>: Weight of process error <code>omega_{proc}</code>. Default is <code>1.0</code>.</li><li><code>obs_weight</code>: Weight of observation error <code>omega_{obs}</code>. Default is <code>1.0</code>.</li><li><code>reg_weight</code>: Weight of regularization error <code>omega_{reg}</code>. Default is <code>10^-6</code>.</li><li><code>reg_type</code>: Type of regularization, whether <code>&quot;L1&quot;</code> or <code>&quot;L2&quot;</code> regularization. Default is <code>&quot;L2&quot;</code>.</li><li><code>l</code>: Extrapolation parameter for forecasting. Default is <code>0.25</code>.</li><li><code>extrap_rho</code>: Extrapolation parameter for forecasting. Default is <code>0.0</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Jack-H-Buckner/UniversalDiffEq.jl/blob/12be76d7cb0507547e9d2a5eac4e2dafeefab18d/src/Models.jl#L149-L173">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="UniversalDiffEq.CustomDifference-Tuple{DataFrame, Any, Any, Function}-Models" href="#UniversalDiffEq.CustomDifference-Tuple{DataFrame, Any, Any, Function}-Models"><code>UniversalDiffEq.CustomDifference</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">CustomDifference(data::DataFrame,step,initial_parameters,priors::Function;kwargs ... )</code></pre><p>When a function&#39;s priors is supplied its value will be added to the loss function as a penalty term for user specified paramters. It should take the a single NamedTuple <code>p</code> as an argument penalties for each parameter should be calcualted by accessing <code>p</code> with the period operator.</p><pre><code class="language-julia hljs">function priors(p)
    l = 0.01*(p.r - 1.5)^2
    l += 0.01*(p.beta)^2
    return l
end</code></pre><p><strong>kwargs</strong></p><ul><li><code>time_column_name</code>: Name of column in <code>data</code> that corresponds to time. Default is <code>&quot;time&quot;</code>.</li><li><code>proc_weight</code>: Weight of process error <code>omega_{proc}</code>. Default is <code>1.0</code>.</li><li><code>obs_weight</code>: Weight of observation error <code>omega_{obs}</code>. Default is <code>1.0</code>.</li><li><code>reg_weight</code>: Weight of regularization error <code>omega_{reg}</code>. Default is <code>10^-6</code>.</li><li><code>reg_type</code>: Type of regularization, whether <code>&quot;L1&quot;</code> or <code>&quot;L2&quot;</code> regularization. Default is <code>&quot;L2&quot;</code>.</li><li><code>l</code>: Extrapolation parameter for forecasting. Default is <code>0.25</code>.</li><li><code>extrap_rho</code>: Extrapolation parameter for forecasting. Default is <code>0.0</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Jack-H-Buckner/UniversalDiffEq.jl/blob/12be76d7cb0507547e9d2a5eac4e2dafeefab18d/src/Models.jl#L373-L395">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« UniversalDiffEq.jl</a><a class="docs-footer-nextpage" href="../EasyModels/">Easy NODE and UDE »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Tuesday 17 September 2024 18:28">Tuesday 17 September 2024</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

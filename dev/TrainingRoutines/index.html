<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Training routines · UniversalDiffEq.jl</title><meta name="title" content="Training routines · UniversalDiffEq.jl"/><meta property="og:title" content="Training routines · UniversalDiffEq.jl"/><meta property="twitter:title" content="Training routines · UniversalDiffEq.jl"/><meta name="description" content="Documentation for UniversalDiffEq.jl."/><meta property="og:description" content="Documentation for UniversalDiffEq.jl."/><meta property="twitter:description" content="Documentation for UniversalDiffEq.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">UniversalDiffEq.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">UniversalDiffEq.jl</a></li><li><a class="tocitem" href="../Models/">Model Constructors</a></li><li><a class="tocitem" href="../EasyModels/">Easy NODE and UDE</a></li><li><a class="tocitem" href="../ModelTesting/">Model performance</a></li><li><a class="tocitem" href="../NutsAndBolts/">UDE model construction</a></li><li><a class="tocitem" href="../MultipleTimeSeries/">Fitting a model to multiple time series</a></li><li><a class="tocitem" href="../modelanalysis/">Model analysis</a></li><li><a class="tocitem" href="../BayesianModels/">Bayesian Models</a></li><li><a class="tocitem" href="../examples/">Examples</a></li><li><a class="tocitem" href="../API/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Training routines</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Training routines</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Jack-H-Buckner/UniversalDiffEq.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Jack-H-Buckner/UniversalDiffEq.jl/blob/main/docs/src/TrainingRoutines.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Training-routines"><a class="docs-heading-anchor" href="#Training-routines">Training routines</a><a id="Training-routines-1"></a><a class="docs-heading-anchor-permalink" href="#Training-routines" title="Permalink"></a></h1><p>There are many differnt methods for training NODE and UDE models. These methods tradeoff between accuracy, stability, and computing time. Their performance may also be related to the characteristics of the training data. However, this is an active area of research where it is difficult to make definitive statements. </p><p>Currently, UniversalDiffEq.jl implements fixed loss functions and two different optimization algorithms that can be accessed through the <code>train!</code> function. The logic behind each method and details of implementation can be found below.</p><h2 id="loss-functions"><a class="docs-heading-anchor" href="#loss-functions">loss functions</a><a id="loss-functions-1"></a><a class="docs-heading-anchor-permalink" href="#loss-functions" title="Permalink"></a></h2><h3 id="Derivative-matching"><a class="docs-heading-anchor" href="#Derivative-matching">Derivative matching</a><a id="Derivative-matching-1"></a><a class="docs-heading-anchor-permalink" href="#Derivative-matching" title="Permalink"></a></h3><p>Derivative matching is the most computationally efficient training procedure implemented by UniversalDiffEq.jl. It works for continuous time models such as those implemented by <code>CustomDerivatives</code> or <code>NODE</code> model building functions. This method was adapted from a tutorial in the DiffEqFlux.jl (documentation)[https://docs.sciml.ai/DiffEqFlux/stable/examples/collocation/] called smooth collocation for fast two-stage training.</p><p>Derivative matching trains the models using a two-step procedure. First, the algorithm fits a smoothing curve <span>$s_i(t)$</span> to each dimension <span>$i$</span> of the time series using a cubic spline implemented by the DataInterpolations.jl package. The model is trained by comparing the right-hand side <span>$f$</span> of the UDE model to the derivatives of the smoothing curve, evaluated at the time of each observation in the data set. </p><p class="math-container">\[L(\theta) = \sum_i \sum_{\tau\in T} \left(\frac{ds_i}/{dt} |_\tau - f_i(s(\tau)\rigt)^2 + \omega_R |\theta_{w}|_{L2} \]</p><p>The final term <span>$\omega_R |\theta_{w}|_{L2} $ applies $L2$</span> regualrization to the neural network weights <span>$\theta_{w}$</span>. The user can specify the weight <span>$\omega_R$</span> using the keyword argument <code>Regularization_weight</code> in the <code>train!</code> function.</p><p>The algorithm can be tuned for a specific data set using the <code>loss_options</code> keyword argument. This argument should be a NamedTyple with values <code>d</code> and <code>remove_ends</code>. The parameter <code>d</code> sets the number of degrees of freedom used by the curve-fitting model. The <code>remove_ends</code> option is an integer. This allows data points from the beginning and end of the data set to be excluded from the loss function. The default value is zero (no observations are excluded), but the smoothing curves might fit poorly near the beginning and end of some data sets. Setting <code>remove_ends &gt; 0</code> can help reduce the influence of these edge effects on the trained model.The smoothing curves are fit using the generalized cross-validation method in the (DataInterpolations.jl)[https://docs.sciml.ai/DataInterpolations/dev/methods/#Regularization-Smoothing] package. This method fits a continous differntiable curve to the data with a smoothing penelty term chosen to minimize the influecne of observaiton errors. </p><p>The success of the training procedure can be evaluated using the <code>plot_state_estimates</code> and <code>plot_predictions</code> functions. The <code>plot_state_estimates</code> will will plot the data using a scatter plot and over lay the smoothing curves with a line plot allowing a visual inspection of the fits. The plot predictons function will show who well the trained UDE predictes the changes in the smoothing curves forecasting one step ahead.  </p><h3 id="State-space-loss-functions"><a class="docs-heading-anchor" href="#State-space-loss-functions">State-space loss functions</a><a id="State-space-loss-functions-1"></a><a class="docs-heading-anchor-permalink" href="#State-space-loss-functions" title="Permalink"></a></h3><p>State-space loss functions assume the data include observation errors and that the underlying dynamics cannot be perfectly predicted by the UDE model. These state-space training rotines account for these sources of unceritainty by embedding the UDE model into a state-space modeling framework.  </p><h3 id="State-space-conditional-likelihood"><a class="docs-heading-anchor" href="#State-space-conditional-likelihood">State-space conditional likelihood</a><a id="State-space-conditional-likelihood-1"></a><a class="docs-heading-anchor-permalink" href="#State-space-conditional-likelihood" title="Permalink"></a></h3><h3 id="Shooting"><a class="docs-heading-anchor" href="#Shooting">Shooting</a><a id="Shooting-1"></a><a class="docs-heading-anchor-permalink" href="#Shooting" title="Permalink"></a></h3><h3 id="Multiple-shooting"><a class="docs-heading-anchor" href="#Multiple-shooting">Multiple shooting</a><a id="Multiple-shooting-1"></a><a class="docs-heading-anchor-permalink" href="#Multiple-shooting" title="Permalink"></a></h3></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Friday 21 February 2025 21:58">Friday 21 February 2025</span>. Using Julia version 1.10.8.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

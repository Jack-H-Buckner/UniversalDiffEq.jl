<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Cross validation · UniversalDiffEq.jl</title><meta name="title" content="Cross validation · UniversalDiffEq.jl"/><meta property="og:title" content="Cross validation · UniversalDiffEq.jl"/><meta property="twitter:title" content="Cross validation · UniversalDiffEq.jl"/><meta name="description" content="Documentation for UniversalDiffEq.jl."/><meta property="og:description" content="Documentation for UniversalDiffEq.jl."/><meta property="twitter:description" content="Documentation for UniversalDiffEq.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">UniversalDiffEq.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">UniversalDiffEq.jl</a></li><li><a class="tocitem" href="../Models/">Model Constructors</a></li><li><a class="tocitem" href="../TrainingRoutines/">Training routines</a></li><li><a class="tocitem" href="../ModelTesting/">Model performance</a></li><li class="is-active"><a class="tocitem" href>Cross validation</a><ul class="internal"><li><a class="tocitem" href="#doc-string"><span>doc string</span></a></li><li><a class="tocitem" href="#Minimal-example"><span>Minimal example</span></a></li></ul></li><li><a class="tocitem" href="../NutsAndBolts/">UDE model construction</a></li><li><a class="tocitem" href="../MultipleTimeSeries/">Fitting a model to multiple time series</a></li><li><a class="tocitem" href="../modelanalysis/">Model analysis</a></li><li><a class="tocitem" href="../examples/">Examples</a></li><li><a class="tocitem" href="../API/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Cross validation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Cross validation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Jack-H-Buckner/UniversalDiffEq.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Jack-H-Buckner/UniversalDiffEq.jl/blob/main/docs/src/CrossValidation.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Cross-validation"><a class="docs-heading-anchor" href="#Cross-validation">Cross validation</a><a id="Cross-validation-1"></a><a class="docs-heading-anchor-permalink" href="#Cross-validation" title="Permalink"></a></h1><p>The out-of-sample performance of UDE models can be estimated using leave future out cross-validation. Leave future out cross-validation creates testing data sets by leaving observation off of the end of the data set. The model is trained on the remaining data to predict the test sets. The difference between the models&#39; forecasts at the training data provides an estimate of the model&#39;s performance on new data.</p><p>Our specific implementation constructs a use-defined number of testing data sets <code>k</code> by sequentially leaving one data point off of the end of the data set. The model is trained on the remaining data and used to forecast from that last time point in the training data set to the last time point in the training data set. If the data are sampled at regular intervals, This resutls in <code>k</code> estimates of the model&#39;s ahead forecasting skill <code>k-1</code> estimates of is forecasting skill two steps and more generally <code>k-h+1</code> estimates of its forecasting skill <code>h</code> time step into the future.</p><p>The cross-validation function will return a data frame with the mean absolute error of the forecasts and the associated standard error at each forecast horizon <code>h&lt;k</code>. The function will also return the raw values in the testing data set and the values predicted by the model. These rate data can be used to calculate other statistics, like the mean squared error.</p><p>The leave future out cross validation function will work if there are missing data or the data set is sampled at irregular intervals, but this will affect the number of times the algorithm can test each forecast horizon <code>h</code>. In these cases, we recommend calculating your own model performance statistics using the raw data returned by the algorithm rather than relying on the summary statistics.</p><p>The <code>leave_future_out</code> cross-validation function takes a model object, a training routine, and the number of tests <code>k</code> as arguments. The model object is either a <code>MultiUDE</code> or <code>UDE</code> object. The training routine <code>training!</code> is a function that takes the model as an argument and updates its parameters in place. In the simplest case, the <code>training!</code> function could just be a wrapper for <code>UniversalDiffEq.train</code>.</p><pre><code class="language-julia hljs">training! = (model) -&gt; train!(model,loss_function = &quot;derivative matching&quot;)</code></pre><p>The taining routine function can also be used to test a combination of methods.</p><pre><code class="language-julia hljs">function training!(model)
   UniversalDiffEq.train!(model,loss_function = &quot;derivative matching&quot;,
                                   optim_options = (maxiter = 500, ),
                                   loss_options = (observation_error = 0.25,))
   UniversalDiffEq.train!(model,loss_function = &quot;marginal likeihood&quot;,
                                   optim_options = (maxiter = 100, ),
                                   loss_options = (observation_error = 0.25,))
end</code></pre><p>The function will return a data set with the high level summary statistics from the cross validaiton tests this data frame has three columns the time horizon, the mean absolute error the forecasts (MAE) and the standartd error of the MAE estimates. </p><table><tr><th style="text-align: right">horizon</th><th style="text-align: right">mean<em>absolute</em>error</th><th style="text-align: right">standard<em>error</em>of_MAE</th></tr><tr><td style="text-align: right">1</td><td style="text-align: right">MAE1</td><td style="text-align: right">SE1</td></tr><tr><td style="text-align: right">2</td><td style="text-align: right">MAE2</td><td style="text-align: right">SE2</td></tr><tr><td style="text-align: right">...</td><td style="text-align: right">...</td><td style="text-align: right">...</td></tr></table><p>In addtion to the sumamery data frame the function will return a named tuple with additonal data frames. These include the raw data from the leave future out cross validaiton algorithm and more detailed summary statistics. The raw data report the iteration of the cross validation algorithm <code>fold</code>, the time of the testing observation in the original data set <code>time</code> , the time horizon of the forecast <code>horizon</code>, the value of the testing data point <code>testing</code>  and the value of the forecast <code>forecast</code>. If the algorithm was run on a model with multiple time series there will also be a column indicating which time sereis the testing data came from <code>series</code></p><table><tr><th style="text-align: right">fold</th><th style="text-align: right">time</th><th style="text-align: right">horizon</th><th style="text-align: right">varaible</th><th style="text-align: right">testing</th><th style="text-align: right">forecast</th></tr><tr><td style="text-align: right">1</td><td style="text-align: right">50</td><td style="text-align: right">1</td><td style="text-align: right">x</td><td style="text-align: right">0.1</td><td style="text-align: right">0.12</td></tr><tr><td style="text-align: right">2</td><td style="text-align: right">50</td><td style="text-align: right">2</td><td style="text-align: right">x</td><td style="text-align: right">0.1</td><td style="text-align: right">0.05</td></tr><tr><td style="text-align: right">2</td><td style="text-align: right">49</td><td style="text-align: right">1</td><td style="text-align: right">x</td><td style="text-align: right">0.251</td><td style="text-align: right">0.201</td></tr><tr><td style="text-align: right">3</td><td style="text-align: right">50</td><td style="text-align: right">3</td><td style="text-align: right">x</td><td style="text-align: right">0.1</td><td style="text-align: right">-0.012</td></tr><tr><td style="text-align: right">3</td><td style="text-align: right">49</td><td style="text-align: right">2</td><td style="text-align: right">x</td><td style="text-align: right">0.251</td><td style="text-align: right">0.12</td></tr><tr><td style="text-align: right">3</td><td style="text-align: right">48</td><td style="text-align: right">1</td><td style="text-align: right">x</td><td style="text-align: right">0.184</td><td style="text-align: right">0.191</td></tr><tr><td style="text-align: right">...</td><td style="text-align: right">...</td><td style="text-align: right">...</td><td style="text-align: right">...</td><td style="text-align: right">...</td><td style="text-align: right">...</td></tr></table><p>The other data sets report the mean absolute error and assocaited statnard errors grouping the data in differnt ways. For example, the <code>horizon_by_var</code> data set reports the mean absolute error for each variable independently. </p><h2 id="doc-string"><a class="docs-heading-anchor" href="#doc-string">doc string</a><a id="doc-string-1"></a><a class="docs-heading-anchor-permalink" href="#doc-string" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="UniversalDiffEq.leave_future_out-Tuple{UDE, Any, Any}-CrossValidation" href="#UniversalDiffEq.leave_future_out-Tuple{UDE, Any, Any}-CrossValidation"><code>UniversalDiffEq.leave_future_out</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">leave_future_out(model::UDE, training!, k; kwargs... )</code></pre><p>Runs a leave future out cross validation on the UDe model <code>model</code> using the training routine <code>train!</code> with <code>k</code>  folds.  if a path to a csv file is provided usign the path key word then the raw testing data and forecasts will be saved for each fold.  </p><p>The funtion returns three data frames. The first contains an estimate of the mean aboslue error of the forecasts and assocaited standard error as a fuction of the forecast horizon (1 to k time steps into the future). The second and third are returned in a named tuple with two elements <code>horizon_by_var</code> and <code>raw</code>. The data frame <code>horizon_by_var</code> is containds the forecasting errors seperated by variable and the data frame <code>raw</code> contains the raw testing and forecasting data.  If the model is trained on multiple time series the named tupe will include a third data frame <code>horizon_by_var_by_series</code>.</p><pre><code class="nohighlight hljs"># kwargs</code></pre><ul><li><code>path</code>: the path to a directory to save the output dataframes, defaults to Null</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Jack-H-Buckner/UniversalDiffEq.jl/blob/9cdc125a8f2d016a66c301cf9e643044e0ebc4f8/src/CrossValidation.jl#L111-L124">source</a></section></article><h2 id="Minimal-example"><a class="docs-heading-anchor" href="#Minimal-example">Minimal example</a><a id="Minimal-example-1"></a><a class="docs-heading-anchor-permalink" href="#Minimal-example" title="Permalink"></a></h2><pre><code class="language-julia hljs">using UniversalDiffEq, Random, DataFrames

data = DataFrame(time = 1:40,  x = rand(40), y = rand(40), z = rand(40))

NN,NNparams = UniversalDiffEq.SimpleNeuralNetwork(3,3)
function derivs!(u,i,p,t)
   zeros(3)
end

init_parameters = (NN = NNparams,)

model = UniversalDiffEq.CustomDerivatives(training,derivs!,init_parameters)

function training_routine_4!(model)
   UniversalDiffEq.train!(model,loss_function = &quot;conditional likelihood&quot;,
                                   optim_options = (maxiter = 2, ),
                                   loss_options = (observation_error = 0.25,))
end

cv_summary, cv_details = UniversalDiffEq.leave_future_out(model, training_routine_4!, 10)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ModelTesting/">« Model performance</a><a class="docs-footer-nextpage" href="../NutsAndBolts/">UDE model construction »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Tuesday 8 April 2025 02:05">Tuesday 8 April 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
